substitutions:
  # Device info
  device_name: "plugs-controller"
  friendly_name: "Kauf Plugs Controller"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}
  platformio_options:
    board_build.flash_size: 16MB
    board_build.flash_mode: dio
    board_build.partitions: default_16MB.csv

esp32:
  board: esp32-s3-devkitc-1
  variant: ESP32S3
  flash_size: 16MB
  framework:
    type: esp-idf

# Enable logging
logger:
  level: INFO

# Enable Home Assistant API
api:
  reboot_timeout: 0s
  encryption:
    key: "+6lkh+FkWq3HVFh6+NukfmN188wGMQap7sw2RK1p9Gg="

# OTA updates
ota:
  - platform: esphome
    password: "48170f28ed94e6fe392d67906b01ff74"

# WiFi configuration
wifi:
  ssid: "JEREMY"
  password: "605506Jdb"
  power_save_mode: NONE
  reboot_timeout: 0s

  # Fallback hotspot
  ap:
    ssid: "${friendly_name} Hotspot"
    password: "12345678"

# Web server for UI at plugs.local
web_server:
  port: 80
  version: 2
  local: true
  ota: false

# mDNS for plugs.local
mdns:
  disabled: false

# Captive portal
captive_portal:

# HTTP client for Kauf plug control
http_request:
  id: http_client
  timeout: 2s

# Time component for scheduling
time:
  - platform: sntp
    id: sntp_time
    timezone: America/Detroit

# Preferences - immediate flash writes
preferences:
  flash_write_interval: 0s

# ============================================
# TEXT - Configurable Plug Names and IPs
# ============================================
text:
  # Plug 1 Configuration
  - platform: template
    id: plug1_name
    name: "Plug 1 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 1"
    mode: text
    restore_value: true

  - platform: template
    id: plug1_ip
    name: "Plug 1 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.79"
    mode: text
    restore_value: true

  # Plug 2 Configuration
  - platform: template
    id: plug2_name
    name: "Plug 2 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 2"
    mode: text
    restore_value: true

  - platform: template
    id: plug2_ip
    name: "Plug 2 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.77"
    mode: text
    restore_value: true

  # Plug 3 Configuration
  - platform: template
    id: plug3_name
    name: "Plug 3 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 3"
    mode: text
    restore_value: true

  - platform: template
    id: plug3_ip
    name: "Plug 3 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.76"
    mode: text
    restore_value: true

  # Plug 4 Configuration
  - platform: template
    id: plug4_name
    name: "Plug 4 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 4"
    mode: text
    restore_value: true

  - platform: template
    id: plug4_ip
    name: "Plug 4 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.75"
    mode: text
    restore_value: true

  # Plug 5 Configuration
  - platform: template
    id: plug5_name
    name: "Plug 5 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 5"
    mode: text
    restore_value: true

  - platform: template
    id: plug5_ip
    name: "Plug 5 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.203"
    mode: text
    restore_value: true

  # Plug 6 Configuration
  - platform: template
    id: plug6_name
    name: "Plug 6 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 6"
    mode: text
    restore_value: true

  - platform: template
    id: plug6_ip
    name: "Plug 6 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.204"
    mode: text
    restore_value: true

  # Plug 7 Configuration
  - platform: template
    id: plug7_name
    name: "Plug 7 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 7"
    mode: text
    restore_value: true

  - platform: template
    id: plug7_ip
    name: "Plug 7 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.205"
    mode: text
    restore_value: true

  # Plug 8 Configuration
  - platform: template
    id: plug8_name
    name: "Plug 8 Name"
    optimistic: true
    min_length: 0
    max_length: 20
    initial_value: "PLUG 8"
    mode: text
    restore_value: true

  - platform: template
    id: plug8_ip
    name: "Plug 8 IP Address"
    optimistic: true
    min_length: 0
    max_length: 15
    initial_value: "192.168.68.206"
    mode: text
    restore_value: true

# ============================================
# GLOBALS - Timer Settings (Persisted to Flash)
# ============================================
globals:
  # Plug 1 Timer Settings
  - id: plug1_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug1_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug1_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug1_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug1_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug1_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug1_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 2 Timer Settings
  - id: plug2_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug2_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug2_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug2_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug2_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug2_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug2_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 3 Timer Settings
  - id: plug3_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug3_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug3_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug3_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug3_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug3_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug3_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 4 Timer Settings
  - id: plug4_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug4_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug4_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug4_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug4_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug4_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug4_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 5 Timer Settings
  - id: plug5_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug5_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug5_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug5_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug5_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug5_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug5_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 6 Timer Settings
  - id: plug6_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug6_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug6_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug6_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug6_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug6_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug6_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 7 Timer Settings
  - id: plug7_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug7_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug7_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug7_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug7_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug7_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug7_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

  # Plug 8 Timer Settings
  - id: plug8_schedule_persist
    type: bool
    restore_value: yes
    initial_value: 'false'
  - id: plug8_on_hour_persist
    type: int
    restore_value: yes
    initial_value: '8'
  - id: plug8_on_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug8_off_hour_persist
    type: int
    restore_value: yes
    initial_value: '6'
  - id: plug8_off_minute_persist
    type: int
    restore_value: yes
    initial_value: '0'
  - id: plug8_on_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"AM"'
  - id: plug8_off_ampm_persist
    type: std::string
    restore_value: yes
    max_restore_data_length: 4
    initial_value: '"PM"'

# ============================================
# BINARY SENSORS - Track Actual Plug States
# ============================================
binary_sensor:
  # Plug 1 State
  - platform: template
    id: plug1_state
    name: "Plug 1 State"
    device_class: power
    lambda: |-
      return false;  // Updated by HTTP response

  # Plug 2 State
  - platform: template
    id: plug2_state
    name: "Plug 2 State"
    device_class: power
    lambda: |-
      return false;

  # Plug 3 State
  - platform: template
    id: plug3_state
    name: "Plug 3 State"
    device_class: power
    lambda: |-
      return false;

  # Plug 4 State
  - platform: template
    id: plug4_state
    name: "Plug 4 State"
    device_class: power
    lambda: |-
      return false;

  # Plug 5 State
  - platform: template
    id: plug5_state
    name: "Plug 5 State"
    device_class: power
    lambda: |-
      return false;

  # Plug 6 State
  - platform: template
    id: plug6_state
    name: "Plug 6 State"
    device_class: power
    lambda: |-
      return false;

  # Plug 7 State
  - platform: template
    id: plug7_state
    name: "Plug 7 State"
    device_class: power
    lambda: |-
      return false;

  # Plug 8 State
  - platform: template
    id: plug8_state
    name: "Plug 8 State"
    device_class: power
    lambda: |-
      return false;

# ============================================
# BUTTONS - Direct Plug Control
# ============================================
button:
  # Plug 1 Controls
  - platform: template
    name: "Plug 1 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug1_turn_on

  - platform: template
    name: "Plug 1 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug1_turn_off

  # Plug 2 Controls
  - platform: template
    name: "Plug 2 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug2_turn_on

  - platform: template
    name: "Plug 2 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug2_turn_off

  # Plug 3 Controls
  - platform: template
    name: "Plug 3 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug3_turn_on

  - platform: template
    name: "Plug 3 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug3_turn_off

  # Plug 4 Controls
  - platform: template
    name: "Plug 4 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug4_turn_on

  - platform: template
    name: "Plug 4 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug4_turn_off

  # Plug 5 Controls
  - platform: template
    name: "Plug 5 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug5_turn_on

  - platform: template
    name: "Plug 5 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug5_turn_off

  # Plug 6 Controls
  - platform: template
    name: "Plug 6 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug6_turn_on

  - platform: template
    name: "Plug 6 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug6_turn_off

  # Plug 7 Controls
  - platform: template
    name: "Plug 7 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug7_turn_on

  - platform: template
    name: "Plug 7 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug7_turn_off

  # Plug 8 Controls
  - platform: template
    name: "Plug 8 ON"
    icon: mdi:power-plug
    on_press:
      - script.execute: plug8_turn_on

  - platform: template
    name: "Plug 8 OFF"
    icon: mdi:power-plug-off
    on_press:
      - script.execute: plug8_turn_off

# ============================================
# SWITCHES - Timer Enable/Disable
# ============================================
switch:
  # Plug 1 Timer Enable
  - platform: template
    id: plug1_schedule_enabled
    name: "Plug 1 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug1_schedule_persist);
    turn_on_action:
      - lambda: id(plug1_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug1_schedule_persist) = false;

  # Plug 2 Timer Enable
  - platform: template
    id: plug2_schedule_enabled
    name: "Plug 2 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug2_schedule_persist);
    turn_on_action:
      - lambda: id(plug2_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug2_schedule_persist) = false;

  # Plug 3 Timer Enable
  - platform: template
    id: plug3_schedule_enabled
    name: "Plug 3 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug3_schedule_persist);
    turn_on_action:
      - lambda: id(plug3_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug3_schedule_persist) = false;

  # Plug 4 Timer Enable
  - platform: template
    id: plug4_schedule_enabled
    name: "Plug 4 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug4_schedule_persist);
    turn_on_action:
      - lambda: id(plug4_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug4_schedule_persist) = false;

  # Plug 5 Timer Enable
  - platform: template
    id: plug5_schedule_enabled
    name: "Plug 5 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug5_schedule_persist);
    turn_on_action:
      - lambda: id(plug5_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug5_schedule_persist) = false;

  # Plug 6 Timer Enable
  - platform: template
    id: plug6_schedule_enabled
    name: "Plug 6 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug6_schedule_persist);
    turn_on_action:
      - lambda: id(plug6_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug6_schedule_persist) = false;

  # Plug 7 Timer Enable
  - platform: template
    id: plug7_schedule_enabled
    name: "Plug 7 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug7_schedule_persist);
    turn_on_action:
      - lambda: id(plug7_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug7_schedule_persist) = false;

  # Plug 8 Timer Enable
  - platform: template
    id: plug8_schedule_enabled
    name: "Plug 8 Timer"
    icon: mdi:timer
    lambda: |-
      return id(plug8_schedule_persist);
    turn_on_action:
      - lambda: id(plug8_schedule_persist) = true;
    turn_off_action:
      - lambda: id(plug8_schedule_persist) = false;

# ============================================
# NUMBERS - Timer Hours and Minutes
# ============================================
number:
  # Plug 1 Timer Settings
  - platform: template
    id: plug1_on_hour
    name: "Plug 1 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug1_on_hour_persist);
    set_action:
      - lambda: id(plug1_on_hour_persist) = (int)x;

  - platform: template
    id: plug1_on_minute
    name: "Plug 1 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug1_on_minute_persist);
    set_action:
      - lambda: id(plug1_on_minute_persist) = (int)x;

  - platform: template
    id: plug1_off_hour
    name: "Plug 1 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug1_off_hour_persist);
    set_action:
      - lambda: id(plug1_off_hour_persist) = (int)x;

  - platform: template
    id: plug1_off_minute
    name: "Plug 1 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug1_off_minute_persist);
    set_action:
      - lambda: id(plug1_off_minute_persist) = (int)x;

  # Plug 2 Timer Settings
  - platform: template
    id: plug2_on_hour
    name: "Plug 2 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug2_on_hour_persist);
    set_action:
      - lambda: id(plug2_on_hour_persist) = (int)x;

  - platform: template
    id: plug2_on_minute
    name: "Plug 2 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug2_on_minute_persist);
    set_action:
      - lambda: id(plug2_on_minute_persist) = (int)x;

  - platform: template
    id: plug2_off_hour
    name: "Plug 2 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug2_off_hour_persist);
    set_action:
      - lambda: id(plug2_off_hour_persist) = (int)x;

  - platform: template
    id: plug2_off_minute
    name: "Plug 2 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug2_off_minute_persist);
    set_action:
      - lambda: id(plug2_off_minute_persist) = (int)x;

  # Plug 3 Timer Settings
  - platform: template
    id: plug3_on_hour
    name: "Plug 3 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug3_on_hour_persist);
    set_action:
      - lambda: id(plug3_on_hour_persist) = (int)x;

  - platform: template
    id: plug3_on_minute
    name: "Plug 3 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug3_on_minute_persist);
    set_action:
      - lambda: id(plug3_on_minute_persist) = (int)x;

  - platform: template
    id: plug3_off_hour
    name: "Plug 3 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug3_off_hour_persist);
    set_action:
      - lambda: id(plug3_off_hour_persist) = (int)x;

  - platform: template
    id: plug3_off_minute
    name: "Plug 3 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug3_off_minute_persist);
    set_action:
      - lambda: id(plug3_off_minute_persist) = (int)x;

  # Plug 4 Timer Settings
  - platform: template
    id: plug4_on_hour
    name: "Plug 4 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug4_on_hour_persist);
    set_action:
      - lambda: id(plug4_on_hour_persist) = (int)x;

  - platform: template
    id: plug4_on_minute
    name: "Plug 4 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug4_on_minute_persist);
    set_action:
      - lambda: id(plug4_on_minute_persist) = (int)x;

  - platform: template
    id: plug4_off_hour
    name: "Plug 4 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug4_off_hour_persist);
    set_action:
      - lambda: id(plug4_off_hour_persist) = (int)x;

  - platform: template
    id: plug4_off_minute
    name: "Plug 4 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug4_off_minute_persist);
    set_action:
      - lambda: id(plug4_off_minute_persist) = (int)x;

  # Plug 5 Timer Settings
  - platform: template
    id: plug5_on_hour
    name: "Plug 5 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug5_on_hour_persist);
    set_action:
      - lambda: id(plug5_on_hour_persist) = (int)x;

  - platform: template
    id: plug5_on_minute
    name: "Plug 5 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug5_on_minute_persist);
    set_action:
      - lambda: id(plug5_on_minute_persist) = (int)x;

  - platform: template
    id: plug5_off_hour
    name: "Plug 5 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug5_off_hour_persist);
    set_action:
      - lambda: id(plug5_off_hour_persist) = (int)x;

  - platform: template
    id: plug5_off_minute
    name: "Plug 5 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug5_off_minute_persist);
    set_action:
      - lambda: id(plug5_off_minute_persist) = (int)x;

  # Plug 6 Timer Settings
  - platform: template
    id: plug6_on_hour
    name: "Plug 6 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug6_on_hour_persist);
    set_action:
      - lambda: id(plug6_on_hour_persist) = (int)x;

  - platform: template
    id: plug6_on_minute
    name: "Plug 6 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug6_on_minute_persist);
    set_action:
      - lambda: id(plug6_on_minute_persist) = (int)x;

  - platform: template
    id: plug6_off_hour
    name: "Plug 6 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug6_off_hour_persist);
    set_action:
      - lambda: id(plug6_off_hour_persist) = (int)x;

  - platform: template
    id: plug6_off_minute
    name: "Plug 6 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug6_off_minute_persist);
    set_action:
      - lambda: id(plug6_off_minute_persist) = (int)x;

  # Plug 7 Timer Settings
  - platform: template
    id: plug7_on_hour
    name: "Plug 7 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug7_on_hour_persist);
    set_action:
      - lambda: id(plug7_on_hour_persist) = (int)x;

  - platform: template
    id: plug7_on_minute
    name: "Plug 7 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug7_on_minute_persist);
    set_action:
      - lambda: id(plug7_on_minute_persist) = (int)x;

  - platform: template
    id: plug7_off_hour
    name: "Plug 7 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug7_off_hour_persist);
    set_action:
      - lambda: id(plug7_off_hour_persist) = (int)x;

  - platform: template
    id: plug7_off_minute
    name: "Plug 7 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug7_off_minute_persist);
    set_action:
      - lambda: id(plug7_off_minute_persist) = (int)x;

  # Plug 8 Timer Settings
  - platform: template
    id: plug8_on_hour
    name: "Plug 8 On Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug8_on_hour_persist);
    set_action:
      - lambda: id(plug8_on_hour_persist) = (int)x;

  - platform: template
    id: plug8_on_minute
    name: "Plug 8 On Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug8_on_minute_persist);
    set_action:
      - lambda: id(plug8_on_minute_persist) = (int)x;

  - platform: template
    id: plug8_off_hour
    name: "Plug 8 Off Hour"
    min_value: 1
    max_value: 12
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug8_off_hour_persist);
    set_action:
      - lambda: id(plug8_off_hour_persist) = (int)x;

  - platform: template
    id: plug8_off_minute
    name: "Plug 8 Off Minute"
    min_value: 0
    max_value: 59
    step: 1
    icon: mdi:clock-outline
    lambda: |-
      return (float)id(plug8_off_minute_persist);
    set_action:
      - lambda: id(plug8_off_minute_persist) = (int)x;

# ============================================
# SELECTS - AM/PM Selection
# ============================================
select:
  # Plug 1 AM/PM
  - platform: template
    id: plug1_on_ampm
    name: "Plug 1 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug1_on_ampm_persist);
    set_action:
      - lambda: id(plug1_on_ampm_persist) = x;

  - platform: template
    id: plug1_off_ampm
    name: "Plug 1 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug1_off_ampm_persist);
    set_action:
      - lambda: id(plug1_off_ampm_persist) = x;

  # Plug 2 AM/PM
  - platform: template
    id: plug2_on_ampm
    name: "Plug 2 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug2_on_ampm_persist);
    set_action:
      - lambda: id(plug2_on_ampm_persist) = x;

  - platform: template
    id: plug2_off_ampm
    name: "Plug 2 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug2_off_ampm_persist);
    set_action:
      - lambda: id(plug2_off_ampm_persist) = x;

  # Plug 3 AM/PM
  - platform: template
    id: plug3_on_ampm
    name: "Plug 3 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug3_on_ampm_persist);
    set_action:
      - lambda: id(plug3_on_ampm_persist) = x;

  - platform: template
    id: plug3_off_ampm
    name: "Plug 3 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug3_off_ampm_persist);
    set_action:
      - lambda: id(plug3_off_ampm_persist) = x;

  # Plug 4 AM/PM
  - platform: template
    id: plug4_on_ampm
    name: "Plug 4 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug4_on_ampm_persist);
    set_action:
      - lambda: id(plug4_on_ampm_persist) = x;

  - platform: template
    id: plug4_off_ampm
    name: "Plug 4 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug4_off_ampm_persist);
    set_action:
      - lambda: id(plug4_off_ampm_persist) = x;

  # Plug 5 AM/PM
  - platform: template
    id: plug5_on_ampm
    name: "Plug 5 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug5_on_ampm_persist);
    set_action:
      - lambda: id(plug5_on_ampm_persist) = x;

  - platform: template
    id: plug5_off_ampm
    name: "Plug 5 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug5_off_ampm_persist);
    set_action:
      - lambda: id(plug5_off_ampm_persist) = x;

  # Plug 6 AM/PM
  - platform: template
    id: plug6_on_ampm
    name: "Plug 6 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug6_on_ampm_persist);
    set_action:
      - lambda: id(plug6_on_ampm_persist) = x;

  - platform: template
    id: plug6_off_ampm
    name: "Plug 6 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug6_off_ampm_persist);
    set_action:
      - lambda: id(plug6_off_ampm_persist) = x;

  # Plug 7 AM/PM
  - platform: template
    id: plug7_on_ampm
    name: "Plug 7 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug7_on_ampm_persist);
    set_action:
      - lambda: id(plug7_on_ampm_persist) = x;

  - platform: template
    id: plug7_off_ampm
    name: "Plug 7 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug7_off_ampm_persist);
    set_action:
      - lambda: id(plug7_off_ampm_persist) = x;

  # Plug 8 AM/PM
  - platform: template
    id: plug8_on_ampm
    name: "Plug 8 On AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug8_on_ampm_persist);
    set_action:
      - lambda: id(plug8_on_ampm_persist) = x;

  - platform: template
    id: plug8_off_ampm
    name: "Plug 8 Off AM/PM"
    options: ["AM", "PM"]
    icon: mdi:clock-outline
    lambda: |-
      return id(plug8_off_ampm_persist);
    set_action:
      - lambda: id(plug8_off_ampm_persist) = x;

# ============================================
# SCRIPTS - HTTP Control for Kauf Plugs (Dynamic IPs)
# ============================================
script:
  # Plug 1 Scripts
  - id: plug1_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug1_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug1_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug1_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 2 Scripts
  - id: plug2_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug2_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug2_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug2_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 3 Scripts
  - id: plug3_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug3_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug3_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug3_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 4 Scripts
  - id: plug4_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug4_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug4_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug4_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 5 Scripts
  - id: plug5_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug5_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug5_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug5_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 6 Scripts
  - id: plug6_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug6_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug6_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug6_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 7 Scripts
  - id: plug7_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug7_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug7_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug7_ip).state + std::string("/switch/kauf_plug/turn_off");

  # Plug 8 Scripts
  - id: plug8_turn_on
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug8_ip).state + std::string("/switch/kauf_plug/turn_on");

  - id: plug8_turn_off
    then:
      - http_request.post:
          url: !lambda |-
            return std::string("http://") + id(plug8_ip).state + std::string("/switch/kauf_plug/turn_off");

# ============================================
# INTERVAL - Check Timers Every Minute
# ============================================
interval:
  - interval: 60s
    then:
      - lambda: |-
          auto now = id(sntp_time).now();
          if (!now.is_valid()) return;

          int current_hour = now.hour;
          int current_minute = now.minute;

          // Helper function to convert 12-hour to 24-hour
          auto to_24h = [](int h12, std::string ampm) -> int {
            if (ampm == "AM") {
              return (h12 == 12) ? 0 : h12;
            } else {
              return (h12 == 12) ? 12 : h12 + 12;
            }
          };

          // Plug 1 Schedule Check
          if (id(plug1_schedule_persist)) {
            int on_h = to_24h(id(plug1_on_hour_persist), id(plug1_on_ampm_persist));
            int off_h = to_24h(id(plug1_off_hour_persist), id(plug1_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug1_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 1");
              id(plug1_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug1_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 1");
              id(plug1_turn_off).execute();
            }
          }

          // Plug 2 Schedule Check
          if (id(plug2_schedule_persist)) {
            int on_h = to_24h(id(plug2_on_hour_persist), id(plug2_on_ampm_persist));
            int off_h = to_24h(id(plug2_off_hour_persist), id(plug2_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug2_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 2");
              id(plug2_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug2_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 2");
              id(plug2_turn_off).execute();
            }
          }

          // Plug 3 Schedule Check
          if (id(plug3_schedule_persist)) {
            int on_h = to_24h(id(plug3_on_hour_persist), id(plug3_on_ampm_persist));
            int off_h = to_24h(id(plug3_off_hour_persist), id(plug3_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug3_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 3");
              id(plug3_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug3_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 3");
              id(plug3_turn_off).execute();
            }
          }

          // Plug 4 Schedule Check
          if (id(plug4_schedule_persist)) {
            int on_h = to_24h(id(plug4_on_hour_persist), id(plug4_on_ampm_persist));
            int off_h = to_24h(id(plug4_off_hour_persist), id(plug4_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug4_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 4");
              id(plug4_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug4_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 4");
              id(plug4_turn_off).execute();
            }
          }

          // Plug 5 Schedule Check
          if (id(plug5_schedule_persist)) {
            int on_h = to_24h(id(plug5_on_hour_persist), id(plug5_on_ampm_persist));
            int off_h = to_24h(id(plug5_off_hour_persist), id(plug5_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug5_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 5");
              id(plug5_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug5_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 5");
              id(plug5_turn_off).execute();
            }
          }

          // Plug 6 Schedule Check
          if (id(plug6_schedule_persist)) {
            int on_h = to_24h(id(plug6_on_hour_persist), id(plug6_on_ampm_persist));
            int off_h = to_24h(id(plug6_off_hour_persist), id(plug6_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug6_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 6");
              id(plug6_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug6_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 6");
              id(plug6_turn_off).execute();
            }
          }

          // Plug 7 Schedule Check
          if (id(plug7_schedule_persist)) {
            int on_h = to_24h(id(plug7_on_hour_persist), id(plug7_on_ampm_persist));
            int off_h = to_24h(id(plug7_off_hour_persist), id(plug7_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug7_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 7");
              id(plug7_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug7_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 7");
              id(plug7_turn_off).execute();
            }
          }

          // Plug 8 Schedule Check
          if (id(plug8_schedule_persist)) {
            int on_h = to_24h(id(plug8_on_hour_persist), id(plug8_on_ampm_persist));
            int off_h = to_24h(id(plug8_off_hour_persist), id(plug8_off_ampm_persist));

            if (current_hour == on_h && current_minute == id(plug8_on_minute_persist)) {
              ESP_LOGI("Timer", "Turning ON Plug 8");
              id(plug8_turn_on).execute();
            }
            if (current_hour == off_h && current_minute == id(plug8_off_minute_persist)) {
              ESP_LOGI("Timer", "Turning OFF Plug 8");
              id(plug8_turn_off).execute();
            }
          }
